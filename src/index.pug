doctype html
html(lang="en")
	head
	title Digger █▮ v240118
	meta(name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0")
	meta(charset="utf-8")
	
	link(rel="stylesheet", href="./index.less")
	script(type="module", src="./index.ts" async defer)

body.appcore
	#popup.hidden
		btn#popup_close
		header#popup_header xxx
		container#popup_content_wrapper 
			container#popup_content
	#approot.flex-row.colors-default.size-fill
		#header.flex-column.gap-minor.icons-s1.container.bg-default
			o.padding-minimum DT █
			btn(data-tab="play-tab").icon.img-play.tab-switch
			btn(data-tab="edit-tab").icon.img-edit.tab-switch
			btn(data-tab="library-tab").icon.img-library.tab-switch
			btn(data-tab="debug-tab").icon.img-debug.tab-switch
			btn(data-tab="docs-tab").icon.img-docs.tab-switch
		#apptabs.size-fill
			tab#play-tab.size-fill.hidden.display-block
				container#gameroot.size-fill.display-block
					container#gameui.size-fill.display-block.position-absolute
						a gameui
			tab#edit-tab.hidden
				a edit
			tab#library-tab.hidden.size-fill.flex-row.padding-minimum.gap-minor.styleset-a
				section.flex-column.display-block.size-limit
					container#assets-library-add.style-window.behave-collapsing.flex-column.width-medium
						.header add assets
						content.padding-minor.flex-column.buttons-list-s1.size-limit
							btn upload file
				section.flex-column.display-block.size-limit
					container#assets-library-list.style-window.behave-collapsing.flex-column.width-medium-x4.size-limit.overflow-auto
						.header assets list
						content.padding-minor.flex-column.buttons-list-s1.size-limit.overflow-auto
				section.flex-column.flex-column.size-limit.gap-minor
					container#assets-library-details.style-window.behave-collapsing.flex-column.width-medium-x2
						.header asset details
						content.flex-column
					container#assets-library-manage.style-window.behave-collapsing.flex-column.width-medium-x2
						.header asset manage
						content.padding-minor.flex-column
				section.flex-column.flex-column.size-limit.gap-minor
					container#assets-library-preview.style-window.behave-collapsing.flex-column.width-medium-x4
						.header asset preview
						content
			tab#debug-tab.flex-row.gap-minor.styleset-a.padding-minimum
				section.flex-column
					container#testcases-select-window.style-window.behave-collapsing.flex-column.width-medium
						.header tests
						content.padding-minor.flex-column.buttons-list-s1
							btn(data-tab="testcase-matters-tab").tab-switch "matters" test
							btn(data-tab="testcase-assets-tab").tab-switch assets test
				section#testcase-matters-tab.flex-column
					container#testcase-matters-window.style-window.behave-collapsing.flex-column.width-medium-x2
						.header "matters" test
						content.padding-minor
				section#testcase-assets-tab.flex-column
					container#testcase-assets-window.style-window.behave-collapsing.flex-column.width-medium-x2
						.header assets test
						content.padding-minor
							btn#testcase-matters-tab.tab-switch bbb
			tab#docs-tab.hidden
				a docs
	#rootlayout.hidden
		#header
			o digger toolbox █
			a(href="#scene_view") scene
			a(href="#assets_view") assets
			a(href="#dev_view") dev
		page#scene_view
			page.sidebar_l#scene_edit_sidebar
				splitter scene
				page#scene_edit_list
				page#scene_edit_details.hidden
					container.frame_background.flex-row
						a.btn#back_to_scene_list_btn_save.icon.img-save(tooltip="save and close" href="#scene_edit_list")
						a.btn#back_to_scene_list_btn_unsave.icon.img-close(tooltip="close without saving" href="#scene_edit_list")
					splitter palette
					container#scene_tools_palette
						btn#add_scene_model_btn add model
						btn#add_scene_tileset_btn add tileset
						btn#add_scene_trigger_btn add trigger
						btn#add_scene_mapentry_btn add mapentry
						btn#add_scene_mapexit_btn add mapexit
					splitter elements
					container#scene_edit_elements
			#scene_view_canvas_container.view
				container#scene_edit_tools
					container.frame_background.flex-row
						btn#controls_mode_transform_translate.icon.img-translate(tooltip="translate")
						btn#controls_mode_transform_rotate.icon.img-rotate(tooltip="rotate")
						btn#controls_mode_transform_scale.icon.img-scale(tooltip="scale")
						btn#controls_mode_transform_toggle_snap.icon(tooltip="snap")
						btn#controls_mode_transform_toggle_world.icon.img-transform-mode(tooltip="transform local/world")
						btn#controls_mode_draw_tiles.icon.img-draw(tooltip="draw tiles")
						btn#controls_mode_erase_tiles.icon.img-erase(tooltip="erase tiles")
					container#scene_game_controls.frame_background.flex-row
						btn#play_scene_btn.icon.img-play(tooltip="play")
						btn#physics_toggle_autostep.highlighted.icon.img-play-timer(tooltip="physics autostep")
						btn#physics_toggle_camera_attach.icon.img-attach_camera(tooltip="attach camera")
						btn#physics_toggle_collision_debug.icon.img-physdebug(tooltip="debug physics")
						btn#game_center_camera.icon.img-center-camera(tooltip="center camera")
						btn#game_clip_tilesets.icon.img-clip-tileset.highlighted(tooltip="clip tilesets")
					container#asset_view_controls.frame_background.flex-row
						btn#asset_make_thumbnail.icon.img-screenshoot(tooltip="make thumbnail")
					container#scene_game_details.frame_background
						splitter#app_state_details-toggle.cursor-pointer app state
						container#app_state_details.flex-table.hidden
						splitter#scene_state_details-toggle.cursor-pointer scene state
						container#scene_state_details.flex-table.hidden
						splitter#game_config_details-toggle.cursor-pointer game confing
						container#game_config_details.flex-table.hidden
						splitter#character_config_details-toggle.cursor-pointer character confing
						container#character_config_details.flex-table.hidden
						splitter#character_state_details-toggle.cursor-pointer character state
						container#character_state_details.flex-table.hidden
				canvas#rootcanvas.position-absolute
			.footer
				o scene viewer
				o v5
		page#assets_view
			page.sidebar_l.hidden#asset_details
				container#asset_details_content
				splitter asset preview
				container#asset_preview_container
					page#img_asset_preview
						img#asset_preview_img
					page#canvas_asset_preview
			page.sidebar_l#asset_create
				splitter create
				a.btn#upload_gltf_btn Import gltf
				a.btn#create_model_btn Create model
				a.btn#create_tileset_btn Create tileset
				a.btn#create_scene_btn Create scene
				splitter or upload any files
				form#assets_upload
					input#assets_upload_files(type="file" name="files" multiple)
					input(type="submit" value="Upload")
			.view
				container#assets_taglist.flex-row
				splitter &
				tilegrid#assets_list
				splitter &
				a.btn(href="#asset_create") Create new
			.footer
				o assets viewer
				o v2
		page#dev_view
			.sidebar_l
			.view
				splitter игра
				ul
					li 
						| model и tile durability задаются числом вида 0xAB или 0xAABB где A/AA - запас прочности, B/BB - сопротивление повреждениям. 
						| Если сопротивление выше урона, то повреждений не наносится.
					li 
						| mapetry, mapexit. Элементы для входа/выхода на карту
						| Для элемента типа mapexit указывается значение в поле signal вида "XX" или "XX,YY" где XX - id сцены, на которую совершается переход,
						| YY - id элемента, на который будет перемещен персонаж. Если YY не указан, персонаж будет перемещен на произвольный mapentry
				splitter запросы
				ul
					li GET /, /editor - alias для папки сборки ./dist
					li POST /assets/upload - загрузка новых файлов. Возвращает массив новых id
					li POST /assets/upload/:id - обновление параметров уже существующих файлов
					li GET /assets/list - массив id всех загруженных файлов
					li GET /assets/get/:id - объект информации о ассете
					li GET /assets/load/:id/:revision - отправляет файл по id ассета. revision - номер ревизии. revision ставить last для загрузки последней версии
					li GET /assets/load?name=something - ищет в ассетах тот что соответствует всем параметрам в query. Временное решение
				splitter заметки
				ul Поддерживает работу с:
					li изображения разных видов
					li glb, gltf. для gltf необходимо загружать .bin и текстуру 

				ul тудушки:
					li ✔️ todo 1: при загрузке сохранять всю необходимую информацию по жсонкам
					li ✔️ todo 2: редактировать всевозможные параметры ресурсов - имя, расположение, теги, т.п.
					li (да и пофиг) todo 3: файлы поддерживают версии ревизий но работать с ними пока нельзя, используется последняя
					li ✔️ todo 4: предпросмотр изображений, предпросмотр моделей
				ul заметки:
					li отображаем список загруженных ассетов (вероятно всех, с фильтрами)
					li сцены тоже должны показываться где-то в этом списке (?)
					li нужно иметь возможность (возможности, блин. Чо тут хотел дописать хз)
			.footer
				o dev section
	db#cache
		canvas#cache_canvas
	db#templates
		template#asset_details_template
			splitter asset details
			form#asset_props
				label name
					input(value="%s", type="text" name="name", required)
				label tags
					input(value="%s", type="text" name="tags")
				label extension
					input(value="%s", type="text", name="extension" required disabled)
				label#assets_upload_files_label reupload 
					input#assets_upload_files(type="file" name="files" accept=".%s")
				splitter asset edit
				container#asset_details_properties_edit.flex-table
					page#details_empty_edit
					page#details_model_edit
					page#details_tileset_edit
				input(type="submit" value="save")
		template#details_tileset_edit_template
			container#details_tileset_properties_list
			splitter aliases
			container#details_tileset_aliases_list.flex-table
			btn#details_tileset_aliases_add add